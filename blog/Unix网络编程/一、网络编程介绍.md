---
title: 一、网络编程介绍
categories: 编码
tags:
  - 网络编程
  - C++
date: 2018-02-24 23:24:21
---

### 概述
编写一个网络通讯程序， 首先要确定其通信所用的协议(protocol)。而在设计一个协议前，需要确定通信由谁发起及响应何时发生。一般服务器程序是一个长时间运行的守护程序(daemon),仅当接收到客户端的请求时作出响应发送网络消息。

在设计网络应用时，总是由客户发起请求往往能简化协议和程序本身。当然一些较为复杂的网络应用还需异步回调(asynchronous callback)通信，也就是由服务器向客户发起请求消息。

本节讨论不限于传输控制协议TCP，还讨论UDP(user datagram protocol,用户数据报协议)。其中的IP通常是IPv4，IPv4为其正式名称(IP vestion 4)。其他还有IPv6，将来会取代IPv4。

同一网络的客户和服务程序不仅能处于同一局域网(local area network,LAN),还能使用路由器(router)连接到广域网(wide area network, WAN)。

路由器是广域网的架构设备。当今最大的广域网为因特网(Internet),公司企业内部可构建自己的广域网。



<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="processonSvg1000" viewBox="73.0 83.0 396.0 95.0" width="396.0" height="95.0"><defs id="ProcessOnDefs1001"><marker id="ProcessOnMarker1015" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="15.23606797749979" refY="3.8990363547948754"><path id="ProcessOnPath1016" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(-1.0,1.2246467991473532E-16,-1.2246467991473532E-16,-1.0,14.23606797749979,7.798072709589751)"/></marker><marker id="ProcessOnMarker1017" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1018" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker></defs><g id="ProcessOnG1002"><path id="ProcessOnPath1003" d="M73.0 83.0H469.0V178.0H73.0V83.0Z" fill="none"/><g id="ProcessOnG1004"><g id="ProcessOnG1005" transform="matrix(1.0,0.0,0.0,1.0,93.0,122.0)" opacity="1.0"><path id="ProcessOnPath1006" d="M0.0 0.0L82.0 0.0L82.0 36.0L0.0 36.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1007" transform="matrix(1.0,0.0,0.0,1.0,10.0,9.875)"><text id="ProcessOnText1008" fill="#000000" font-size="13" x="30.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">客户</text></g></g><g id="ProcessOnG1009" transform="matrix(1.0,0.0,0.0,1.0,367.0,122.0)" opacity="1.0"><path id="ProcessOnPath1010" d="M0.0 0.0L82.0 0.0L82.0 36.0L0.0 36.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1011" transform="matrix(1.0,0.0,0.0,1.0,10.0,9.875)"><text id="ProcessOnText1012" fill="#000000" font-size="13" x="30.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">服务器</text></g></g><g id="ProcessOnG1013"><path id="ProcessOnPath1014" d="M190.2360679774998 140.0L271.0 140.0L271.0 140.0L351.7639320225002 140.0" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-start="url(#ProcessOnMarker1015)" marker-end="url(#ProcessOnMarker1017)"/></g><g id="ProcessOnG1019" transform="matrix(1.0,0.0,0.0,1.0,185.0,103.0)" opacity="1.0"><path id="ProcessOnPath1020" d="M0.0 0.0L160.0 0.0L160.0 40.0L0.0 40.0Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" opacity="1.0" fill="none"/><g id="ProcessOnG1021" transform="matrix(1.0,0.0,0.0,1.0,0.0,11.875)"><text id="ProcessOnText1022" fill="#000000" font-size="13" x="79.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">应用协议</text></g></g></g></g></svg>

通常情况客户每次只与一个服务器通信，但web浏览器可以同时打开多个网页与多个服务器通信。从服务器角度，一个服务器跟多个客户通信并不稀奇。

可认为服务端与客户端是通过某个网络协议通信的，但是实际通信涉及多个网络协议层。本节要点为TCP/IP协议(网际协议)。例如，web客户与服务器之间使用TCP(transmission control protocol,传输控制协议)通信。TCP又转而使用IP(Internet Protocol,网际协议)通信。IP再通过数据链路层通信。如下图:

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="processonSvg1000" viewBox="88.0 193.0 588.0 449.0" width="588.0" height="449.0"><defs id="ProcessOnDefs1001"><marker id="ProcessOnMarker1041" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="15.23606797749979" refY="3.8990363547948754"><path id="ProcessOnPath1042" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(-1.0,1.2246467991473532E-16,-1.2246467991473532E-16,-1.0,14.23606797749979,7.798072709589751)"/></marker><marker id="ProcessOnMarker1043" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1044" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1063" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="15.23606797749979" refY="3.8990363547948754"><path id="ProcessOnPath1064" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(-1.0,1.2246467991473532E-16,-1.2246467991473532E-16,-1.0,14.23606797749979,7.798072709589751)"/></marker><marker id="ProcessOnMarker1065" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1066" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1069" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="15.23606797749979" refY="3.8990363547948754"><path id="ProcessOnPath1070" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(-1.0,1.2246467991473532E-16,-1.2246467991473532E-16,-1.0,14.23606797749979,7.798072709589751)"/></marker><marker id="ProcessOnMarker1071" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1072" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1075" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="15.23606797749979" refY="3.8990363547948754"><path id="ProcessOnPath1076" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(-1.0,1.2246467991473532E-16,-1.2246467991473532E-16,-1.0,14.23606797749979,7.798072709589751)"/></marker><marker id="ProcessOnMarker1077" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1078" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1081" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="15.23606797749979" refY="3.8990363547948754"><path id="ProcessOnPath1082" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(-1.0,1.2246467991473532E-16,-1.2246467991473532E-16,-1.0,14.23606797749979,7.798072709589751)"/></marker><marker id="ProcessOnMarker1083" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1084" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1087" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="15.23606797749979" refY="3.8990363547948754"><path id="ProcessOnPath1088" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(-1.0,1.2246467991473532E-16,-1.2246467991473532E-16,-1.0,14.23606797749979,7.798072709589751)"/></marker><marker id="ProcessOnMarker1089" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1090" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1093" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="15.23606797749979" refY="3.8990363547948754"><path id="ProcessOnPath1094" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(-1.0,1.2246467991473532E-16,-1.2246467991473532E-16,-1.0,14.23606797749979,7.798072709589751)"/></marker><marker id="ProcessOnMarker1095" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1096" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1099" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="15.23606797749979" refY="3.8990363547948754"><path id="ProcessOnPath1100" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(-1.0,1.2246467991473532E-16,-1.2246467991473532E-16,-1.0,14.23606797749979,7.798072709589751)"/></marker><marker id="ProcessOnMarker1101" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1102" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1105" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="15.23606797749979" refY="3.8990363547948754"><path id="ProcessOnPath1106" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(-1.0,1.2246467991473532E-16,-1.2246467991473532E-16,-1.0,14.23606797749979,7.798072709589751)"/></marker><marker id="ProcessOnMarker1107" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1108" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1111" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="15.23606797749979" refY="3.8990363547948754"><path id="ProcessOnPath1112" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(-1.0,1.2246467991473532E-16,-1.2246467991473532E-16,-1.0,14.23606797749979,7.798072709589751)"/></marker><marker id="ProcessOnMarker1113" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1114" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1150" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="15.23606797749979" refY="3.8990363547948754"><path id="ProcessOnPath1151" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(-1.0,1.2246467991473532E-16,-1.2246467991473532E-16,-1.0,14.23606797749979,7.798072709589751)"/></marker><marker id="ProcessOnMarker1152" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1153" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker></defs><g id="ProcessOnG1002"><path id="ProcessOnPath1003" d="M88.0 193.0H676.0V642.0H88.0V193.0Z" fill="none"/><g id="ProcessOnG1004"><g id="ProcessOnG1005" transform="matrix(1.0,0.0,0.0,1.0,215.0,226.0)" opacity="1.0"><path id="ProcessOnPath1006" d="M0.0 0.0L100.0 0.0L100.0 35.0L0.0 35.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1007" transform="matrix(1.0,0.0,0.0,1.0,10.0,9.375)"><text id="ProcessOnText1008" fill="#000000" font-size="13" x="39.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">WEB客户</text></g></g><g id="ProcessOnG1009" transform="matrix(1.0,0.0,0.0,1.0,215.0,311.0)" opacity="1.0"><path id="ProcessOnPath1010" d="M0.0 0.0L100.0 0.0L100.0 35.0L0.0 35.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1011" transform="matrix(1.0,0.0,0.0,1.0,10.0,9.375)"><text id="ProcessOnText1012" fill="#000000" font-size="13" x="39.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">TCP</text></g></g><g id="ProcessOnG1013" transform="matrix(1.0,0.0,0.0,1.0,215.0,403.0)" opacity="1.0"><path id="ProcessOnPath1014" d="M0.0 0.0L100.0 0.0L100.0 35.0L0.0 35.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1015" transform="matrix(1.0,0.0,0.0,1.0,10.0,9.375)"><text id="ProcessOnText1016" fill="#000000" font-size="13" x="39.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">IP</text></g></g><g id="ProcessOnG1017" transform="matrix(1.0,0.0,0.0,1.0,215.0,503.0)" opacity="1.0"><path id="ProcessOnPath1018" d="M0.0 0.0L100.0 0.0L100.0 35.0L0.0 35.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1019" transform="matrix(1.0,0.0,0.0,1.0,10.0,1.25)"><text id="ProcessOnText1020" fill="#000000" font-size="13" x="39.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">以太网驱动程</text><text id="ProcessOnText1021" fill="#000000" font-size="13" x="39.0" y="29.575" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">序</text></g></g><g id="ProcessOnG1022" transform="matrix(1.0,0.0,0.0,1.0,475.0,226.0)" opacity="1.0"><path id="ProcessOnPath1023" d="M0.0 0.0L100.0 0.0L100.0 35.0L0.0 35.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1024" transform="matrix(1.0,0.0,0.0,1.0,10.0,9.375)"><text id="ProcessOnText1025" fill="#000000" font-size="13" x="39.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">WEB服务器</text></g></g><g id="ProcessOnG1026" transform="matrix(1.0,0.0,0.0,1.0,475.0,311.0)" opacity="1.0"><path id="ProcessOnPath1027" d="M0.0 0.0L100.0 0.0L100.0 35.0L0.0 35.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1028" transform="matrix(1.0,0.0,0.0,1.0,10.0,9.375)"><text id="ProcessOnText1029" fill="#000000" font-size="13" x="39.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">TCP</text></g></g><g id="ProcessOnG1030" transform="matrix(1.0,0.0,0.0,1.0,475.0,403.0)" opacity="1.0"><path id="ProcessOnPath1031" d="M0.0 0.0L100.0 0.0L100.0 35.0L0.0 35.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1032" transform="matrix(1.0,0.0,0.0,1.0,10.0,9.375)"><text id="ProcessOnText1033" fill="#000000" font-size="13" x="39.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">IP</text></g></g><g id="ProcessOnG1034" transform="matrix(1.0,0.0,0.0,1.0,475.0,503.0)" opacity="1.0"><path id="ProcessOnPath1035" d="M0.0 0.0L100.0 0.0L100.0 35.0L0.0 35.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1036" transform="matrix(1.0,0.0,0.0,1.0,10.0,1.25)"><text id="ProcessOnText1037" fill="#000000" font-size="13" x="39.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">以太网驱动程</text><text id="ProcessOnText1038" fill="#000000" font-size="13" x="39.0" y="29.575" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">序</text></g></g><g id="ProcessOnG1039"><path id="ProcessOnPath1040" d="M330.2360679774998 243.5L395.0 243.5L395.0 243.5L459.7639320225002 243.5" stroke="#323232" stroke-width="2.0" stroke-dasharray="2.0 3.0" fill="none" marker-start="url(#ProcessOnMarker1041)" marker-end="url(#ProcessOnMarker1043)"/></g><g id="ProcessOnG1045" transform="matrix(1.0,0.0,0.0,1.0,315.0,213.0)" opacity="1.0"><path id="ProcessOnPath1046" d="M0.0 0.0L160.0 0.0L160.0 40.0L0.0 40.0Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" opacity="1.0" fill="none"/><g id="ProcessOnG1047" transform="matrix(1.0,0.0,0.0,1.0,0.0,11.875)"><text id="ProcessOnText1048" fill="#000000" font-size="13" x="79.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">应用协议</text></g></g><g id="ProcessOnG1049" transform="matrix(1.0,0.0,0.0,1.0,312.0,297.5)" opacity="1.0"><path id="ProcessOnPath1050" d="M0.0 0.0L160.0 0.0L160.0 40.0L0.0 40.0Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" opacity="1.0" fill="none"/><g id="ProcessOnG1051" transform="matrix(1.0,0.0,0.0,1.0,0.0,11.875)"><text id="ProcessOnText1052" fill="#000000" font-size="13" x="79.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">TCP协议</text></g></g><g id="ProcessOnG1053" transform="matrix(1.0,0.0,0.0,1.0,318.0,391.5)" opacity="1.0"><path id="ProcessOnPath1054" d="M0.0 0.0L160.0 0.0L160.0 40.0L0.0 40.0Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" opacity="1.0" fill="none"/><g id="ProcessOnG1055" transform="matrix(1.0,0.0,0.0,1.0,0.0,11.875)"><text id="ProcessOnText1056" fill="#000000" font-size="13" x="79.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">IP协议</text></g></g><g id="ProcessOnG1057" transform="matrix(1.0,0.0,0.0,1.0,315.0,490.5)" opacity="1.0"><path id="ProcessOnPath1058" d="M0.0 0.0L160.0 0.0L160.0 40.0L0.0 40.0Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" opacity="1.0" fill="none"/><g id="ProcessOnG1059" transform="matrix(1.0,0.0,0.0,1.0,0.0,11.875)"><text id="ProcessOnText1060" fill="#000000" font-size="13" x="79.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">以太网协议</text></g></g><g id="ProcessOnG1061"><path id="ProcessOnPath1062" d="M330.2360679774998 328.5L395.0 328.5L395.0 328.5L459.7639320225002 328.5" stroke="#323232" stroke-width="2.0" stroke-dasharray="2.0 3.0" fill="none" marker-start="url(#ProcessOnMarker1063)" marker-end="url(#ProcessOnMarker1065)"/></g><g id="ProcessOnG1067"><path id="ProcessOnPath1068" d="M330.2360679774998 420.5L395.0 420.5L395.0 420.5L459.7639320225002 420.5" stroke="#323232" stroke-width="2.0" stroke-dasharray="2.0 3.0" fill="none" marker-start="url(#ProcessOnMarker1069)" marker-end="url(#ProcessOnMarker1071)"/></g><g id="ProcessOnG1073"><path id="ProcessOnPath1074" d="M330.2360679774998 520.5L395.0 520.5L395.0 520.5L459.7639320225002 520.5" stroke="#323232" stroke-width="2.0" stroke-dasharray="2.0 3.0" fill="none" marker-start="url(#ProcessOnMarker1075)" marker-end="url(#ProcessOnMarker1077)"/></g><g id="ProcessOnG1079"><path id="ProcessOnPath1080" d="M265.0 361.2360679774998L265.0 374.5L265.0 374.5L265.0 387.7639320225002" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-start="url(#ProcessOnMarker1081)" marker-end="url(#ProcessOnMarker1083)"/></g><g id="ProcessOnG1085"><path id="ProcessOnPath1086" d="M265.0 453.2360679774998L265.0 470.5L265.0 470.5L265.0 487.7639320225002" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-start="url(#ProcessOnMarker1087)" marker-end="url(#ProcessOnMarker1089)"/></g><g id="ProcessOnG1091"><path id="ProcessOnPath1092" d="M265.0 295.7639320225002L265.0 286.0L265.0 286.0L265.0 276.2360679774998" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-start="url(#ProcessOnMarker1093)" marker-end="url(#ProcessOnMarker1095)"/></g><g id="ProcessOnG1097"><path id="ProcessOnPath1098" d="M525.0 276.2360679774998L525.0 286.0L525.0 286.0L525.0 295.7639320225002" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-start="url(#ProcessOnMarker1099)" marker-end="url(#ProcessOnMarker1101)"/></g><g id="ProcessOnG1103"><path id="ProcessOnPath1104" d="M525.0 361.2360679774998L525.0 374.5L525.0 374.5L525.0 387.7639320225002" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-start="url(#ProcessOnMarker1105)" marker-end="url(#ProcessOnMarker1107)"/></g><g id="ProcessOnG1109"><path id="ProcessOnPath1110" d="M525.0 453.2360679774998L525.0 470.5L525.0 470.5L525.0 487.7639320225002" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-start="url(#ProcessOnMarker1111)" marker-end="url(#ProcessOnMarker1113)"/></g><g id="ProcessOnG1115" transform="matrix(1.0,0.0,0.0,1.0,221.0,587.0)" opacity="1.0"><path id="ProcessOnPath1116" d="M0.0 0.0L354.0 0.0L354.0 35.0L0.0 35.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1117" transform="matrix(1.0,0.0,0.0,1.0,10.0,9.375)"><text id="ProcessOnText1118" fill="#000000" font-size="13" x="166.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">以太网</text></g></g><g id="ProcessOnG1119"><path id="ProcessOnPath1120" d="M265.0 538.0L265.0 562.5L265.0 562.5L265.0 587.0" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none"/></g><g id="ProcessOnG1121"><path id="ProcessOnPath1122" d="M525.0 538.0L525.0 562.5L525.0 562.5L525.0 587.0" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none"/></g><g id="ProcessOnG1123" transform="matrix(1.0,0.0,0.0,1.0,575.0,226.0)" opacity="1.0"><path id="ProcessOnPath1124" d="M0.0 0.0L81.0 0.0L81.0 35.0L0.0 35.0Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" opacity="1.0" fill="none"/><g id="ProcessOnG1125" transform="matrix(1.0,0.0,0.0,1.0,0.0,9.375)"><text id="ProcessOnText1126" fill="#000000" font-size="13" x="39.5" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">应用层</text></g></g><g id="ProcessOnG1127" transform="matrix(1.0,0.0,0.0,1.0,575.0,311.0)" opacity="1.0"><path id="ProcessOnPath1128" d="M0.0 0.0L81.0 0.0L81.0 35.0L0.0 35.0Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" opacity="1.0" fill="none"/><g id="ProcessOnG1129" transform="matrix(1.0,0.0,0.0,1.0,0.0,9.375)"><text id="ProcessOnText1130" fill="#000000" font-size="13" x="39.5" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">传输层</text></g></g><g id="ProcessOnG1131" transform="matrix(1.0,0.0,0.0,1.0,575.0,403.0)" opacity="1.0"><path id="ProcessOnPath1132" d="M0.0 0.0L81.0 0.0L81.0 35.0L0.0 35.0Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" opacity="1.0" fill="none"/><g id="ProcessOnG1133" transform="matrix(1.0,0.0,0.0,1.0,0.0,9.375)"><text id="ProcessOnText1134" fill="#000000" font-size="13" x="39.5" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">网络层</text></g></g><g id="ProcessOnG1135" transform="matrix(1.0,0.0,0.0,1.0,575.0,503.0)" opacity="1.0"><path id="ProcessOnPath1136" d="M0.0 0.0L81.0 0.0L81.0 35.0L0.0 35.0Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" opacity="1.0" fill="none"/><g id="ProcessOnG1137" transform="matrix(1.0,0.0,0.0,1.0,0.0,9.375)"><text id="ProcessOnText1138" fill="#000000" font-size="13" x="39.5" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">数据链路层</text></g></g><g id="ProcessOnG1139" transform="matrix(1.0,0.0,0.0,1.0,108.0,317.5)" opacity="1.0"><path id="ProcessOnPath1140" d="M102.0 0.0Q93.0 0.0 93.0 9.0L93.0 51.25Q93.0 60.25 80.0 60.25Q93.0 60.25 93.0 69.25L93.0 111.5Q93.0 120.5 102.0 120.5" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="none"/><path id="ProcessOnPath1141" d="M0.0 0.0L102.0 0.0L102.0 120.5L0.0 120.5Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" opacity="1.0" fill="none"/><g id="ProcessOnG1142" transform="matrix(1.0,0.0,0.0,1.0,0.0,52.125)"><text id="ProcessOnText1143" fill="#000000" font-size="13" x="73.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="end" size="13">协议栈</text></g></g><g id="ProcessOnG1144" transform="matrix(1.0,0.0,0.0,1.0,140.0,224.75)" opacity="1.0"><path id="ProcessOnPath1145" d="M0.0 0.0L55.0 0.0L55.0 37.5L0.0 37.5Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" opacity="1.0" fill="none"/><g id="ProcessOnG1146" transform="matrix(1.0,0.0,0.0,1.0,0.0,10.625)"><text id="ProcessOnText1147" fill="#000000" font-size="13" x="26.5" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">用户进程</text></g></g><g id="ProcessOnG1148"><path id="ProcessOnPath1149" d="M299.0 276.2360679774998L299.0 577.0L498.0 577.0L498.0 276.2360679774998" stroke="#323232" stroke-width="2.0" stroke-dasharray="10.0 4.0 2.0 4.0" fill="none" marker-start="url(#ProcessOnMarker1150)" marker-end="url(#ProcessOnMarker1152)"/></g></g></g></svg>

图中可以看出应用之间是通过应用协议通信，传输层通过TCP通信。其中**TCP和IP协议是内核中协议栈的一部分**。需要注意的是，客户与服务之间信息流在其中一端是向下通过协议栈的，跨越网络后，在另一端是向上通过协议栈的。

### 获取时间客户端程序
#### 客户端程序
```C++
#include "stdafx.h"
#include <WinSock2.h>
#include <WS2tcpip.h>
#include <io.h>
#include "unp.h"

#pragma comment(lib,"ws2_32.lib")

int _tmain(int argc, _TCHAR* argv[])
{
  if (argc != 2)
    err_quit("usage:a.out<IPaddress>");

  WSAData wsa;
  // WSAStartup 对socket 进行初始化，用于windows
  // 相当于对Winsock服务初始化
  // 其中第一个参数为初始化版本，低位主版本，高位副版本
  if (::WSAStartup(MAKEWORD(2, 2), &wsa) != 0)
  {
    printf("WSAStartup error");
    return 0;
  }
	

  int sockfd, n;
  // 创建TCP套接字
  // 网际(AF_INET)字节流(SOCK_STREAM)套接字
  if ((sockfd = socket(AF_INET, SOCK_STREAM, 0)) < 0)
    err_sys("socket error");

  // 指定服务器的IP与端口
  // 需要将主机字节序转换为网络字节序
  // 其中端口13为时间获取服务器端口号
  SOCKADDR_IN  servaddr;
  bzero(&servaddr, sizeof(SOCKADDR_IN));
  servaddr.sin_family = AF_INET;
  servaddr.sin_port = htons(13);
  if (inet_pton(AF_INET, argv[1], &servaddr.sin_addr) <= 0)
    err_quit("inet_pton error for %s", argv[1]);

  // 连接服务器
  if (connect(sockfd, (SOCKADDR*)&servaddr, sizeof(SOCKADDR)) < 0)
    err_sys("connect error");

  char recvline[MAX_PATH + 1];
  // 接收服务器发送信息
  while ((n = recv(sockfd, recvline, MAX_PATH, 0)) > 0)
  {
    recvline[n] = 0;

    if (fputs(recvline, stdout) == EOF)
      err_sys("fputs error");
  }

  if (n < 0)
    err_sys("read error");

  ::WSACleanup();
  getchar();
  return 0;
}
```
#### 服务端程序
```C++
// daytime_tcp_server.cpp : Defines the entry point for the console application.
//

#include "stdafx.h"
#include <WinSock2.h>
#include <WS2tcpip.h>
#include <io.h>
#include "unp.h"
#include <time.h>
#pragma comment(lib,"ws2_32.lib")

int
main(int argc, char **argv)
{
  WSAData wsa;
  if (::WSAStartup(MAKEWORD(2, 2), &wsa) != 0)
  {
    printf("WSAStartup error");
    return 0;
  }

  int					listenfd, connfd;
  struct sockaddr_in	servaddr;
  char				buff[MAXLINE];
  time_t				ticks;

  listenfd = socket(AF_INET, SOCK_STREAM, 0);

  bzero(&servaddr, sizeof(servaddr));
  servaddr.sin_family = AF_INET;
  // 将IP地址设为INADDR_ANY，这样服务器主机就有多个网络接口，
  // 服务器进程就可以在任意网络接口上接受客户连接。
  servaddr.sin_addr.s_addr = htonl(INADDR_ANY);
  inet_pton(AF_INET, "127.0.0.1", &servaddr.sin_addr);
  printf(inet_ntoa(servaddr.sin_addr));
  servaddr.sin_port = htons(13);	/* daytime server */

  bind(listenfd, (SOCKADDR*)&servaddr, sizeof(servaddr));
  // 监听套接字，这样由客户外来的连接就可以在该套接字上由内核接受。
  // 其中第二个参数表示在当前套接字上允许最大排队客户连接数。
  listen(listenfd, 5);

  for (; ; ) {
    // 进程在accept调用后进入睡眠，等待客户连接直至被内核接受。
    // TCP连接使用三次握手来建立连接。握手完成时accept返回。
    // 返回一个与客户进行连接的套接字描述符
    connfd = accept(listenfd, (SOCKADDR*)NULL, NULL);

    ticks = time(NULL);
    snprintf(buff, sizeof(buff), "%.24s\r\n", ctime(&ticks));
    send(connfd, buff, strlen(buff), 0);

    closesocket(connfd);
  }

  ::WSACleanup();
}

```
##### 客户端与服务端交互
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="processonSvg1000" viewBox="53.0 75.4605734767025 617.0 455.5394265232975" width="617.0" height="455.5394265232975"><defs id="ProcessOnDefs1001"><marker id="ProcessOnMarker1011" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1012" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1019" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1020" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1027" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1028" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1035" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1036" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1043" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1044" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1055" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1056" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1063" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1064" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1071" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1072" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1108" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1109" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1112" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="15.23606797749979" refY="3.8990363547948754"><path id="ProcessOnPath1113" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(-1.0,1.2246467991473532E-16,-1.2246467991473532E-16,-1.0,14.23606797749979,7.798072709589751)"/></marker><marker id="ProcessOnMarker1114" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1115" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker></defs><g id="ProcessOnG1002"><path id="ProcessOnPath1003" d="M53.0 75.4605734767025H670.0V531.0H53.0V75.4605734767025Z" fill="none"/><g id="ProcessOnG1004"><g id="ProcessOnG1005" transform="matrix(1.0,0.0,0.0,1.0,202.0,99.0)" opacity="1.0"><path id="ProcessOnPath1006" d="M0.0 0.0L100.0 0.0L100.0 25.842293906810035L0.0 25.842293906810035Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1007" transform="matrix(1.0,0.0,0.0,1.0,10.0,4.796146953405017)"><text id="ProcessOnText1008" fill="#000000" font-size="13" x="39.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">socket()</text></g></g><g id="ProcessOnG1009"><path id="ProcessOnPath1010" d="M252.0 124.84229390681003L252.0 150.536917562724L252.00000000000003 150.536917562724L252.00000000000003 160.99547324113817" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-end="url(#ProcessOnMarker1011)"/></g><g id="ProcessOnG1013" transform="matrix(1.0,0.0,0.0,1.0,202.0,176.23154121863797)" opacity="1.0"><path id="ProcessOnPath1014" d="M0.0 0.0L100.0 0.0L100.0 25.842293906810035L0.0 25.842293906810035Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1015" transform="matrix(1.0,0.0,0.0,1.0,10.0,4.796146953405017)"><text id="ProcessOnText1016" fill="#000000" font-size="13" x="39.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">bind()</text></g></g><g id="ProcessOnG1017"><path id="ProcessOnPath1018" d="M252.00000000000003 202.073835125448L252.00000000000003 227.76845878136197L252.00000000000003 227.76845878136197L252.00000000000003 238.22701445977617" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-end="url(#ProcessOnMarker1019)"/></g><g id="ProcessOnG1021" transform="matrix(1.0,0.0,0.0,1.0,202.0,253.46308243727597)" opacity="1.0"><path id="ProcessOnPath1022" d="M0.0 0.0L100.0 0.0L100.0 25.842293906810035L0.0 25.842293906810035Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1023" transform="matrix(1.0,0.0,0.0,1.0,10.0,4.796146953405017)"><text id="ProcessOnText1024" fill="#000000" font-size="13" x="39.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">listen()</text></g></g><g id="ProcessOnG1025"><path id="ProcessOnPath1026" d="M252.00000000000003 279.305376344086L252.00000000000003 305.0L252.00000000000003 305.0L252.00000000000003 315.45855567841414" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-end="url(#ProcessOnMarker1027)"/></g><g id="ProcessOnG1029" transform="matrix(1.0,0.0,0.0,1.0,202.0,330.6946236559139)" opacity="1.0"><path id="ProcessOnPath1030" d="M0.0 0.0L100.0 0.0L100.0 25.842293906810035L0.0 25.842293906810035Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1031" transform="matrix(1.0,0.0,0.0,1.0,10.0,4.796146953405017)"><text id="ProcessOnText1032" fill="#000000" font-size="13" x="39.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">accept()</text></g></g><g id="ProcessOnG1033"><path id="ProcessOnPath1034" d="M252.00000000000003 356.53691756272394L252.00000000000003 382.231541218638L252.00000000000003 382.231541218638L252.00000000000003 392.6900968970522" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-end="url(#ProcessOnMarker1035)"/></g><g id="ProcessOnG1037" transform="matrix(1.0,0.0,0.0,1.0,202.0,407.92616487455194)" opacity="1.0"><path id="ProcessOnPath1038" d="M0.0 0.0L100.0 0.0L100.0 25.842293906810035L0.0 25.842293906810035Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1039" transform="matrix(1.0,0.0,0.0,1.0,10.0,4.796146953405017)"><text id="ProcessOnText1040" fill="#000000" font-size="13" x="39.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">recv()/send()</text></g></g><g id="ProcessOnG1041"><path id="ProcessOnPath1042" d="M252.00000000000003 433.76845878136197L252.00000000000003 459.46308243727594L252.00000000000003 459.46308243727594L252.00000000000003 469.9216381156902" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-end="url(#ProcessOnMarker1043)"/></g><g id="ProcessOnG1045" transform="matrix(1.0,0.0,0.0,1.0,202.0,485.15770609319)" opacity="1.0"><path id="ProcessOnPath1046" d="M0.0 0.0L100.0 0.0L100.0 25.842293906810035L0.0 25.842293906810035Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1047" transform="matrix(1.0,0.0,0.0,1.0,10.0,4.796146953405017)"><text id="ProcessOnText1048" fill="#000000" font-size="13" x="39.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">close()</text></g></g><g id="ProcessOnG1049" transform="matrix(1.0,0.0,0.0,1.0,427.0,253.46308243727606)" opacity="1.0"><path id="ProcessOnPath1050" d="M0.0 0.0L100.0 0.0L100.0 25.842293906810035L0.0 25.842293906810035Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1051" transform="matrix(1.0,0.0,0.0,1.0,10.0,4.796146953405017)"><text id="ProcessOnText1052" fill="#000000" font-size="13" x="39.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">socket()</text></g></g><g id="ProcessOnG1053"><path id="ProcessOnPath1054" d="M477.0 279.3053763440861L477.0 305.00000000000006L477.0 305.00000000000006L477.0 315.45855567841426" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-end="url(#ProcessOnMarker1055)"/></g><g id="ProcessOnG1057" transform="matrix(1.0,0.0,0.0,1.0,427.0,330.69462365591403)" opacity="1.0"><path id="ProcessOnPath1058" d="M0.0 0.0L100.0 0.0L100.0 25.842293906810035L0.0 25.842293906810035Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1059" transform="matrix(1.0,0.0,0.0,1.0,10.0,4.796146953405017)"><text id="ProcessOnText1060" fill="#000000" font-size="13" x="39.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">connect()</text></g></g><g id="ProcessOnG1061"><path id="ProcessOnPath1062" d="M477.0 356.53691756272406L477.0 382.231541218638L477.0 382.231541218638L477.0 392.6900968970522" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-end="url(#ProcessOnMarker1063)"/></g><g id="ProcessOnG1065" transform="matrix(1.0,0.0,0.0,1.0,427.0,407.92616487455194)" opacity="1.0"><path id="ProcessOnPath1066" d="M0.0 0.0L100.0 0.0L100.0 25.842293906810035L0.0 25.842293906810035Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1067" transform="matrix(1.0,0.0,0.0,1.0,10.0,4.796146953405017)"><text id="ProcessOnText1068" fill="#000000" font-size="13" x="39.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">send()/recv()</text></g></g><g id="ProcessOnG1069"><path id="ProcessOnPath1070" d="M477.0 433.768458781362L477.0 459.463082437276L477.0 459.463082437276L477.0 469.9216381156902" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-end="url(#ProcessOnMarker1071)"/></g><g id="ProcessOnG1073" transform="matrix(1.0,0.0,0.0,1.0,427.0,485.15770609319)" opacity="1.0"><path id="ProcessOnPath1074" d="M0.0 0.0L100.0 0.0L100.0 25.842293906810035L0.0 25.842293906810035Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1075" transform="matrix(1.0,0.0,0.0,1.0,10.0,4.796146953405017)"><text id="ProcessOnText1076" fill="#000000" font-size="13" x="39.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">close()</text></g></g><g id="ProcessOnG1077" transform="matrix(1.0,0.0,0.0,1.0,96.0,95.4605734767025)" opacity="1.0"><path id="ProcessOnPath1078" d="M0.0 0.0L119.0 0.0L119.0 32.921146953405014L0.0 32.921146953405014Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" opacity="1.0" fill="none"/><g id="ProcessOnG1079" transform="matrix(1.0,0.0,0.0,1.0,0.0,8.335573476702507)"><text id="ProcessOnText1080" fill="#000000" font-size="13" x="58.5" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">创建socket</text></g></g><g id="ProcessOnG1081" transform="matrix(1.0,0.0,0.0,1.0,96.0,172.69211469534054)" opacity="1.0"><path id="ProcessOnPath1082" d="M0.0 0.0L119.0 0.0L119.0 32.921146953405014L0.0 32.921146953405014Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" opacity="1.0" fill="none"/><g id="ProcessOnG1083" transform="matrix(1.0,0.0,0.0,1.0,0.0,8.335573476702507)"><text id="ProcessOnText1084" fill="#000000" font-size="13" x="58.5" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">绑定IP,端口</text></g></g><g id="ProcessOnG1085" transform="matrix(1.0,0.0,0.0,1.0,96.0,249.9236559139785)" opacity="1.0"><path id="ProcessOnPath1086" d="M0.0 0.0L119.0 0.0L119.0 32.921146953405014L0.0 32.921146953405014Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" opacity="1.0" fill="none"/><g id="ProcessOnG1087" transform="matrix(1.0,0.0,0.0,1.0,0.0,8.335573476702507)"><text id="ProcessOnText1088" fill="#000000" font-size="13" x="58.5" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">监听IP,端口</text></g></g><g id="ProcessOnG1089" transform="matrix(1.0,0.0,0.0,1.0,73.0,330.69462365591403)" opacity="1.0"><path id="ProcessOnPath1090" d="M0.0 0.0L119.0 0.0L119.0 32.921146953405014L0.0 32.921146953405014Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" opacity="1.0" fill="none"/><g id="ProcessOnG1091" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.21057347670250692)"><text id="ProcessOnText1092" fill="#000000" font-size="13" x="58.5" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">阻塞至接收到客户端</text><text id="ProcessOnText1093" fill="#000000" font-size="13" x="58.5" y="29.575" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">连接</text></g></g><g id="ProcessOnG1094" transform="matrix(1.0,0.0,0.0,1.0,83.0,404.38673835125445)" opacity="1.0"><path id="ProcessOnPath1095" d="M0.0 0.0L119.0 0.0L119.0 32.921146953405014L0.0 32.921146953405014Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" opacity="1.0" fill="none"/><g id="ProcessOnG1096" transform="matrix(1.0,0.0,0.0,1.0,0.0,8.335573476702507)"><text id="ProcessOnText1097" fill="#000000" font-size="13" x="58.5" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">发送或接受消息</text></g></g><g id="ProcessOnG1098" transform="matrix(1.0,0.0,0.0,1.0,96.0,478.078853046595)" opacity="1.0"><path id="ProcessOnPath1099" d="M0.0 0.0L119.0 0.0L119.0 32.921146953405014L0.0 32.921146953405014Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" opacity="1.0" fill="none"/><g id="ProcessOnG1100" transform="matrix(1.0,0.0,0.0,1.0,0.0,8.335573476702507)"><text id="ProcessOnText1101" fill="#000000" font-size="13" x="58.5" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">关闭socket</text></g></g><g id="ProcessOnG1102" transform="matrix(1.0,0.0,0.0,1.0,531.0,327.15519713261654)" opacity="1.0"><path id="ProcessOnPath1103" d="M0.0 0.0L119.0 0.0L119.0 32.921146953405014L0.0 32.921146953405014Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" opacity="1.0" fill="none"/><g id="ProcessOnG1104" transform="matrix(1.0,0.0,0.0,1.0,0.0,8.335573476702507)"><text id="ProcessOnText1105" fill="#000000" font-size="13" x="58.5" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">连接服务端</text></g></g><g id="ProcessOnG1106"><path id="ProcessOnPath1107" d="M427.0 343.61577060931904L364.5 343.61577060931904L364.5 343.61577060931893L317.2360679774998 343.61577060931893" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-end="url(#ProcessOnMarker1108)"/></g><g id="ProcessOnG1110"><path id="ProcessOnPath1111" d="M317.2360679774998 420.84731182795696L364.5 420.84731182795696L364.5 420.84731182795696L411.7639320225002 420.84731182795696" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-start="url(#ProcessOnMarker1112)" marker-end="url(#ProcessOnMarker1114)"/></g><g id="ProcessOnG1116" transform="matrix(1.0,0.0,0.0,1.0,283.0,383.0)" opacity="1.0"><path id="ProcessOnPath1117" d="M0.0 0.0L160.0 0.0L160.0 40.0L0.0 40.0Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" opacity="1.0" fill="none"/><g id="ProcessOnG1118" transform="matrix(1.0,0.0,0.0,1.0,0.0,11.875)"><text id="ProcessOnText1119" fill="#000000" font-size="13" x="79.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">数据交互</text></g></g></g></g></svg>

TCP本身并不提供一条记录结束标志，如果应用程序需要确定记录标志，它就需要自己去实现。如：在记录之前放置几个字节表示记录的长度， 或者是记录结束时用某些字符表示。

##### 网络字节序与主机字节序
- 网络字节序
  从高位到低位顺序存储,在网络上统一使用网络字节序，避免兼容问题。

- 主机字节序

  不同的机器因为CPU厂商不同，其数据的顺序不同，与操作系统无关。
  如：Intel x86 的short数据0x1234表示为34 12；int数据0x12345678表示为78 56 34 12。而IBM power pc中的short数据0x1234表示为12 34；int数据0x12345678表示为12 34 56 78

> 计算机网络各层对等实体间交换的单位信息称为协议数据单元(protocol data unit, PDU),分节(segment)就是对应TCP传输层的PDU。按照协议与服务之间的关系，除了物理层，每层的PDU由紧邻的下层提供接口，作为下层服务数据单元(service data unit,SDU)传递给下层，并由下层间接完成本层PDU交换。如果本层PDU大小超过紧邻下层的最大SDU限制，那么本层需事先将PDU划分成若干合适片段由下层分开载送，再在相反的方向把这些片段重组成PDU。

### 协议无关性
以上时间获取程序是协议IPv4协议相关的：分配一个sockaddr_in类型的结构，把该结构的协议族设置成AF_INET。如想要使程序能在IPv6上运行，则需要更改数据结构sockaddr_in为sockaddr_in6,其中的参数更改为AF_INET6。

而真正要实现协议无关，将会探讨，主要调用getaddrinfo函数。

### OSI 模型
描述一个网络中各个协议层的常用方法是使用国际标准化组织(International Orgnization for Standardization, ISO)的计算机通信开放系统互连(Open systems interconnection,OSI)。这是一个七层模型：
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="processonSvg1000" viewBox="124.0 284.0 685.0 325.0" width="685.0" height="325.0"><defs id="ProcessOnDefs1001"><marker id="ProcessOnMarker1057" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="15.23606797749979" refY="3.8990363547948754"><path id="ProcessOnPath1058" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(-1.0,1.2246467991473532E-16,-1.2246467991473532E-16,-1.0,14.23606797749979,7.798072709589751)"/></marker><marker id="ProcessOnMarker1059" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1060" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1063" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="15.23606797749979" refY="3.8990363547948754"><path id="ProcessOnPath1064" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(-1.0,1.2246467991473532E-16,-1.2246467991473532E-16,-1.0,14.23606797749979,7.798072709589751)"/></marker><marker id="ProcessOnMarker1065" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1066" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker></defs><g id="ProcessOnG1002"><path id="ProcessOnPath1003" d="M124.0 284.0H809.0V609.0H124.0V284.0Z" fill="none"/><g id="ProcessOnG1004"><g id="ProcessOnG1005" transform="matrix(1.0,0.0,0.0,1.0,144.0,309.0)" opacity="1.0"><path id="ProcessOnPath1006" d="M0.0 0.0L148.0 0.0L148.0 40.0L0.0 40.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1007" transform="matrix(1.0,0.0,0.0,1.0,10.0,11.875)"><text id="ProcessOnText1008" fill="#000000" font-size="13" x="63.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">应用层</text></g></g><g id="ProcessOnG1009" transform="matrix(1.0,0.0,0.0,1.0,144.0,349.0)" opacity="1.0"><path id="ProcessOnPath1010" d="M0.0 0.0L148.0 0.0L148.0 40.0L0.0 40.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1011" transform="matrix(1.0,0.0,0.0,1.0,10.0,11.875)"><text id="ProcessOnText1012" fill="#000000" font-size="13" x="63.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">表示层</text></g></g><g id="ProcessOnG1013" transform="matrix(1.0,0.0,0.0,1.0,144.0,389.0)" opacity="1.0"><path id="ProcessOnPath1014" d="M0.0 0.0L148.0 0.0L148.0 40.0L0.0 40.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1015" transform="matrix(1.0,0.0,0.0,1.0,10.0,11.875)"><text id="ProcessOnText1016" fill="#000000" font-size="13" x="63.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">会话层</text></g></g><g id="ProcessOnG1017" transform="matrix(1.0,0.0,0.0,1.0,144.0,429.0)" opacity="1.0"><path id="ProcessOnPath1018" d="M0.0 0.0L148.0 0.0L148.0 40.0L0.0 40.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1019" transform="matrix(1.0,0.0,0.0,1.0,10.0,11.875)"><text id="ProcessOnText1020" fill="#000000" font-size="13" x="63.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">传输层</text></g></g><g id="ProcessOnG1021" transform="matrix(1.0,0.0,0.0,1.0,144.0,469.0)" opacity="1.0"><path id="ProcessOnPath1022" d="M0.0 0.0L148.0 0.0L148.0 40.0L0.0 40.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1023" transform="matrix(1.0,0.0,0.0,1.0,10.0,11.875)"><text id="ProcessOnText1024" fill="#000000" font-size="13" x="63.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">网络层</text></g></g><g id="ProcessOnG1025" transform="matrix(1.0,0.0,0.0,1.0,144.0,509.0)" opacity="1.0"><path id="ProcessOnPath1026" d="M0.0 0.0L148.0 0.0L148.0 40.0L0.0 40.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1027" transform="matrix(1.0,0.0,0.0,1.0,10.0,11.875)"><text id="ProcessOnText1028" fill="#000000" font-size="13" x="63.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">数据链路层</text></g></g><g id="ProcessOnG1029" transform="matrix(1.0,0.0,0.0,1.0,144.0,549.0)" opacity="1.0"><path id="ProcessOnPath1030" d="M0.0 0.0L148.0 0.0L148.0 40.0L0.0 40.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1031" transform="matrix(1.0,0.0,0.0,1.0,10.0,11.875)"><text id="ProcessOnText1032" fill="#000000" font-size="13" x="63.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">物理层</text></g></g><g id="ProcessOnG1033" transform="matrix(1.0,0.0,0.0,1.0,334.0,309.0)" opacity="1.0"><path id="ProcessOnPath1034" d="M0.0 0.0L148.0 0.0L148.0 120.0L0.0 120.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1035" transform="matrix(1.0,0.0,0.0,1.0,10.0,51.875)"><text id="ProcessOnText1036" fill="#000000" font-size="13" x="63.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">应用层</text></g></g><g id="ProcessOnG1037" transform="matrix(1.0,0.0,0.0,1.0,334.0,429.0)" opacity="1.0"><path id="ProcessOnPath1038" d="M0.0 0.0L70.0 0.0L70.0 40.0L0.0 40.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1039" transform="matrix(1.0,0.0,0.0,1.0,10.0,11.875)"><text id="ProcessOnText1040" fill="#000000" font-size="13" x="24.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">TCP</text></g></g><g id="ProcessOnG1041" transform="matrix(1.0,0.0,0.0,1.0,412.0,429.0)" opacity="1.0"><path id="ProcessOnPath1042" d="M0.0 0.0L70.0 0.0L70.0 40.0L0.0 40.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1043" transform="matrix(1.0,0.0,0.0,1.0,10.0,11.875)"><text id="ProcessOnText1044" fill="#000000" font-size="13" x="24.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">UDP</text></g></g><g id="ProcessOnG1045" transform="matrix(1.0,0.0,0.0,1.0,334.0,469.0)" opacity="1.0"><path id="ProcessOnPath1046" d="M0.0 0.0L148.0 0.0L148.0 40.0L0.0 40.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1047" transform="matrix(1.0,0.0,0.0,1.0,10.0,11.875)"><text id="ProcessOnText1048" fill="#000000" font-size="13" x="63.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">IPv4、IPv6</text></g></g><g id="ProcessOnG1049" transform="matrix(1.0,0.0,0.0,1.0,334.0,509.0)" opacity="1.0"><path id="ProcessOnPath1050" d="M0.0 0.0L148.0 0.0L148.0 80.0L0.0 80.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" opacity="1.0" fill="#ffffff"/><g id="ProcessOnG1051" transform="matrix(1.0,0.0,0.0,1.0,10.0,31.875)"><text id="ProcessOnText1052" fill="#000000" font-size="13" x="63.0" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">设备驱动程序和硬件</text></g></g><g id="ProcessOnG1053"><path id="ProcessOnPath1054" d="M545.0 430.0L667.0 430.0L667.0 430.0L789.0 430.0" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none"/></g><g id="ProcessOnG1055"><path id="ProcessOnPath1056" d="M597.0 374.2360679774998L597.0 423.5L597.0 423.5L597.0 472.7639320225002" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-start="url(#ProcessOnMarker1057)" marker-end="url(#ProcessOnMarker1059)"/></g><g id="ProcessOnG1061"><path id="ProcessOnPath1062" d="M696.0 358.2360679774998L696.0 439.0L696.0 439.0L696.0 519.7639320225002" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-start="url(#ProcessOnMarker1063)" marker-end="url(#ProcessOnMarker1065)"/></g><g id="ProcessOnG1067" transform="matrix(1.0,0.0,0.0,1.0,558.5,321.0)" opacity="1.0"><path id="ProcessOnPath1068" d="M0.0 0.0L79.0 0.0L79.0 28.0L0.0 28.0Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" opacity="1.0" fill="none"/><g id="ProcessOnG1069" transform="matrix(1.0,0.0,0.0,1.0,0.0,5.875)"><text id="ProcessOnText1070" fill="#000000" font-size="13" x="38.5" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">用户进程</text></g></g><g id="ProcessOnG1071" transform="matrix(1.0,0.0,0.0,1.0,561.5,493.0)" opacity="1.0"><path id="ProcessOnPath1072" d="M0.0 0.0L73.0 0.0L73.0 30.0L0.0 30.0Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" opacity="1.0" fill="none"/><g id="ProcessOnG1073" transform="matrix(1.0,0.0,0.0,1.0,0.0,6.875)"><text id="ProcessOnText1074" fill="#000000" font-size="13" x="35.5" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">内核</text></g></g><g id="ProcessOnG1075" transform="matrix(1.0,0.0,0.0,1.0,655.5,304.0)" opacity="1.0"><path id="ProcessOnPath1076" d="M0.0 0.0L79.0 0.0L79.0 28.0L0.0 28.0Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" opacity="1.0" fill="none"/><g id="ProcessOnG1077" transform="matrix(1.0,0.0,0.0,1.0,0.0,5.875)"><text id="ProcessOnText1078" fill="#000000" font-size="13" x="38.5" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">应用层细节</text></g></g><g id="ProcessOnG1079" transform="matrix(1.0,0.0,0.0,1.0,658.5,549.0)" opacity="1.0"><path id="ProcessOnPath1080" d="M0.0 0.0L79.0 0.0L79.0 28.0L0.0 28.0Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" opacity="1.0" fill="none"/><g id="ProcessOnG1081" transform="matrix(1.0,0.0,0.0,1.0,0.0,5.875)"><text id="ProcessOnText1082" fill="#000000" font-size="13" x="38.5" y="13.325" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="13">通信细节</text></g></g></g></g></svg>

OSI模型的底下两层是随系统提供的设备驱动程序和网络硬件。通常情况下，除了需要知道数据链路层某些特性(如：MTU最大传输单元)外，不必关心着两层的情况

网络层由IPv4和IPv6两个协议处理。可有选择的传输层有UDP和TCP，图中TCP与UDP之间的间隙表示网络应用可绕过传输层，直接使用网络层，这就是所谓的**原始套接字(raw socket)**。

OSI模型顶上三层合为应用层。这就是Web客户(浏览器)、Telnet客户、Web服务器、FTP服务器和其他我们在使用的网络应用所在的层。对于网际协议，此三层没区别。

> **为什么套接字提供的是从OSI模型顶上三层进入传输层的接口？**第一，顶上三层主要处理具体网络应用(如:FTP、Telnet或HTTP)的所有细节，不关心通信细节。通信细节不关心具体网络应用，仅仅处理所有通信细节(发送数据，等待确认，对无序数据进行排序，计算并验证校验和等)；第二，顶上三层通常构成用户进程，而底下四层通常为操作系统内核所提供。综上两点，在第四层与第五层之间为构建套接字API的自然位置。

### BSD网络支持历史
套接字API起源于BSD操作系统。许多Unix系统从某个版本的BSD网络支持代码开始提供网络支持。

### 网络拓扑
编写网络进程需要知道某些网络细节。Unix提供两个基本命令：**netstat**、**ipconfig**

使用**netstat -i** 可以查看所有接口信息，使用**netstat -r**可查看路由表


<br/>
<small>*本文为学习整理《UNIX 网络编程--卷一(第三版)》一书中的要点*</small>

---
<small><font color= "gray">本文[Quenwaz](http://quenwaz.github.io)版权所有，转载请说明出处</font></small>